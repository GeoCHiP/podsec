podsec-nagios-plugins-check-policy(1) -- Плугин проверяет политики настройки контейнеризации на узле
================================

## SYNOPSIS

`podsec-nagios-plugins-check-policy -w уровни_реагирования -c  уровни_реагирования`

## DESCRIPTION

Плугин проверяет политики настройки контейнеризации на узле.

Проверка идет по следующим параметрам:

- файл политики `policy.json`. Наличие (число) пользователей:

    Параметр контроля | Вес метрики
    ------------------|------------- 
    имеющих `defaultPolicy != reject`, но не входящих в группу `podman_dev` | 100
    не имеющих не имеющих `registry.local` в списке регистраторов для которых проверяется наличие электронной подписи образов | 100
    имеющих в политике регистраторы для которых не проверяется наличие электронной подписи образов |100
    имеющих в списке поддерживаемых транспорты отличные от `docker` (транспорт получения образов с регистратора) | 100


- файлы привязки регистраторов к серверам хранящим электронные подписи (файл привязки о умолчанию `default.yaml` и файлы привязки регистраторов `*.yaml` каталога `registries.d`). Наличие (число) пользователей:

    Параметр контроля | Вес метрики
    ------------------|-------------
    не использующих хранилище подписей  `http://sigstore.local:81/sigstore/` как хранилище подписей по умолчанию | 100


- контроль групп пользователей

    * наличие пользователей имеющих образы, но не входящих в группу `podman`:
        Параметр контроля | Вес метрики
        ------------------|-------------
        наличие пользователей имеющих образы, но не входящих в группу `podman` | 100

    * наличие пользователей группы `podman` (за исключением входящих в группу `podman_dev`):

        Параметр контроля | Вес метрики
        ------------------|-------------
        входящих в группу `wheel` | 100
        имеющих каталог `.config/containers/` открытым на запись и изменения | 100 * `доля_нарушителей`
        не имеющих файла конфигурации `.config/containers/storage.conf` | 100 * `доля_нарушителей

`доля_нарушителей` считается как: `число_нарушителей / число_пользователей_группы_podman`

Все веса метрик суммируются и формируется итоговая метрика.

Уровень опасности определяется при запуске флагами:

- для сервера `nagios`:
        
    Уровень         | Флаг     | Рекомендуемое значение
    -----------------|---------|-----
    `критический`    | `-c`    | 100
    `предупреждение` | `-w`    | 0

- для системных логов:

    Уровень       | Флаг | Рекомендуемое значение
    --------------|------|-----------------------
    `аварийный`   | `-a` | 10000
    `фатальный`   | `-f` | 1000
    `критический` | `-c` | 100 
    `высокий`     | `-h` | 80
    `средний`     | `-m` | 40
    `низкий`      | `-l` | 20
    `отладочный`  | `-d` | 10



## OPTIONS


## EXAMPLES

`podsec-nagios-plugins-check-policy`

## SECURITY CONSIDERATIONS



## SEE ALSO

## AUTHOR

Костарев Алексей, Базальт СПО
kaf@basealt.ru
